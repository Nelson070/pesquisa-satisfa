<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa de Satisfa√ß√£o | Feedback</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Existing styles remain the same */
        .hidden {
            display: none !important;
        }
        .active {
            /* Estilo para o bot√£o de avalia√ß√£o ativo na pesquisa de satisfa√ß√£o */
            /* Usar propriedades CSS diretas, pois @apply n√£o funciona com CDN */
            box-shadow: 0 0 0 2px rgb(255, 0, 0); /* ring-2 equivale a box-shadow */
            border-color: rgb(248, 0, 0); /* border-blue-500 */
        }
    </style>
</head>
<body class="flex items-center justify-center p-4 min-h-screen bg-gray-100">
    <div class="w-full max-w-2xl bg-white rounded-xl shadow-xl overflow-hidden">
        <div class="bg-gradient-to-r from-red-600 to-black p-6 text-white">
            <div class="flex items-center mb-4">
                <img src="Logo maquisul - contorno efeito (2).png" class="w-28 h-18" alt="Logo Maquisul">
                <div class="ml-4">
                    <h1 class="text-2xl font-bold">Pesquisa de Satisfa√ß√£o Maquisul</h1>
                    <p class="text-red-100">Sua opini√£o √© muito importante para n√≥s!</p>
                </div>
            </div>
            <div class="w-full bg-black/30 rounded-full h-1.5">
                <div id="progress" class="bg-white progress-bar h-1.5 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <form id="surveyForm" class="p-6" novalidate>
            <div id="step1" class="step">
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Qual foi o motivo do seu contato com a empresa?</h2>
                    <p class="text-gray-600 mb-4">Selecione 1 op√ß√£o</p>

                    <div class="space-y-3">
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-red-50 cursor-pointer">
                            <input type="radio" name="contact_reason" value="compra_pj" class="h-5 w-5 text-red-600 rounded border-gray-300 focus:ring-red-500" required>
                            <span class="ml-3 text-gray-700">Compra - PJ</span>
                        </label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-red-50 cursor-pointer">
                            <input type="radio" name="contact_reason" value="compra_pf" class="h-5 w-5 text-red-600 rounded border-gray-300 focus:ring-red-500" required>
                            <span class="ml-3 text-gray-700">Compra - PF</span>
                        </label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-red-50 cursor-pointer">
                            <input type="radio" name="contact_reason" value="suporte" class="h-5 w-5 text-red-600 rounded border-gray-300 focus:ring-red-500" required>
                            <span class="ml-3 text-gray-700">Suporte T√©cnico</span>
                        </label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-red-50 cursor-pointer">
                            <input type="radio" name="contact_reason" value="reclamacao" class="h-5 w-5 text-red-600 rounded border-gray-300 focus:ring-red-500" required>
                            <span class="ml-3 text-gray-700">Reclama√ß√£o</span>
                        </label>
                        <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-red-50 cursor-pointer">
                            <input type="radio" name="contact_reason" value="outro" class="h-5 w-5 text-red-600 rounded border-gray-300 focus:ring-red-500">
                            <span class="ml-3 text-gray-700">Outro</span>
                        </label>
                        <input type="text" name="other_reason" placeholder="Especifique..." class="border border-gray-300 rounded-md p-2 mt-2 w-full" disabled>
                    </div>
                </div>
            </div>

            <div id="step2" class="step hidden">
                <div class="mb-8 text-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Como voc√™ avalia o nosso atendimento?</h2>
                    <p class="text-gray-600">Selecione uma op√ß√£o abaixo</p>
                </div>

                <div class="flex justify-center space-x-4 mb-8 flex-wrap">
                    <button type="button" class="rating-btn-geral flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="1">
                        <span class="text-3xl mb-1">üòû</span>
                        <span class="text-sm font-medium">P√©ssimo</span>
                    </button>
                    <button type="button" class="rating-btn-geral flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="2">
                        <span class="text-3xl mb-1">üòï</span>
                        <span class="text-sm font-medium">Ruim</span>
                    </button>
                    <button type="button" class="rating-btn-geral flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="3">
                        <span class="text-3xl mb-1">üòê</span>
                        <span class="text-sm font-medium">Regular</span>
                    </button>
                    <button type="button" class="rating-btn-geral flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="4">
                        <span class="text-3xl mb-1">üòä</span>
                        <span class="text-sm font-medium">Bom</span>
                    </button>
                    <button type="button" class="rating-btn-geral flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="5">
                        <span class="text-3xl mb-1">üòç</span>
                        <span class="text-sm font-medium">Excelente</span>
                    </button>
                </div>

                <div id="motivoNegativoContainer" class="mt-4 hidden">
                    <label for="motivoNegativo" class="block text-sm text-red-600"><b>Poderia nos informar o motivo?</b></label>
                    <textarea id="motivoNegativo" name="motivoNegativo" class="w-full border rounded px-3 py-2 mt-1"></textarea>
                </div>
                <input type="hidden" id="rating_geral" name="rating_geral" required>
            </div>

            <div id="step3" class="step hidden">
                <div class="mb-8 text-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Como voc√™ avalia o atendimento do caixa?</h2>
                    <p class="text-gray-600">Selecione uma op√ß√£o abaixo</p>
                </div>

                <div class="flex justify-center space-x-4 mb-8 flex-wrap">
                    <button type="button" class="rating-btn-caixa flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="1">
                        <span class="text-3xl mb-1">üòû</span>
                        <span class="text-sm font-medium">P√©ssimo</span>
                    </button>
                    <button type="button" class="rating-btn-caixa flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="2">
                        <span class="text-3xl mb-1">üòï</span>
                        <span class="text-sm font-medium">Ruim</span>
                    </button>
                    <button type="button" class="rating-btn-caixa flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="3">
                        <span class="text-3xl mb-1">üòê</span>
                        <span class="text-sm font-medium">Regular</span>
                    </button>
                    <button type="button" class="rating-btn-caixa flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="4">
                        <span class="text-3xl mb-1">üòä</span>
                        <span class="text-sm font-medium">Bom</span>
                    </button>
                    <button type="button" class="rating-btn-caixa flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="5">
                        <span class="text-3xl mb-1">üòç</span>
                        <span class="text-sm font-medium">Excelente</span>
                    </button>
                </div>

                <div id="caixaMotivoContainer" class="mt-4 hidden">
                    <label for="caixaMotivo" class="block text-sm font-semibold text-red-600">Poderia nos informar o motivo?</label>
                    <textarea id="caixaMotivo" name="caixaMotivo" rows="3" class="w-full border rounded p-2 mt-1"></textarea>
                </div>
                <input type="hidden" id="caixa_rating" name="caixa_rating" required>
            </div>

            <div id="step4" class="step hidden">
                <div class="mb-8 text-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Como voc√™ avalia o momento da entrega?</h2>
                    <p class="text-gray-600">Selecione uma op√ß√£o abaixo</p>
                </div>

                <div class="flex justify-center space-x-4 mb-8 flex-wrap">
                    <button type="button" class="rating-btn-entrega flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="1">
                        <span class="text-3xl mb-1">üòû</span>
                        <span class="text-sm font-medium">P√©ssimo</span>
                    </button>
                    <button type="button" class="rating-btn-entrega flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="2">
                        <span class="text-3xl mb-1">üòï</span>
                        <span class="text-sm font-medium">Ruim</span>
                    </button>
                    <button type="button" class="rating-btn-entrega flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="3">
                        <span class="text-3xl mb-1">üòê</span>
                        <span class="text-sm font-medium">Regular</span>
                    </button>
                    <button type="button" class="rating-btn-entrega flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="4">
                        <span class="text-3xl mb-1">üòä</span>
                        <span class="text-sm font-medium">Bom</span>
                    </button>
                    <button type="button" class="rating-btn-entrega flex flex-col items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 border border-gray-200 focus:outline-none" data-value="5">
                        <span class="text-3xl mb-1">üòç</span>
                        <span class="text-sm font-medium">Excelente</span>
                    </button>
                </div>

                <div id="entregaMotivoContainer" class="mt-4 hidden">
                    <label for="entregaMotivo" class="block text-sm font-semibold text-red-600">Poderia nos informar o motivo?</label>
                    <textarea id="entregaMotivo" name="entregaMotivo" rows="3" class="w-full border rounded p-2 mt-1"></textarea>
                </div>
                <input type="hidden" id="entrega_rating" name="entrega_rating" required>
            </div>

            <div id="step5" class="step hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">O que podemos melhorar?</h2>
                    <p class="text-gray-600 mb-4">Nos conte o que podemos fazer para te atender ainda melhor</p>

                    <textarea name="suggestion" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="Digite sua sugest√£o aqui..."></textarea>
                </div>
            </div>

            <div id="step6" class="step hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-2">Dados de contato (opcional)</h2>
                    <p class="text-gray-600 mb-4">Preencha se deseja que entremos em contato</p>

                    <div class="space-y-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                            <input type="text" id="name" name="name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="Seu nome">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                            <input type="email" id="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="seu@email.com">
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                            <input type="tel" id="phone" name="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="(00) 00000-0000">
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between mt-8">
                <button type="button" id="prevBtn" class="hidden px-6 py-3 text-red-600 font-medium rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
                    <i class="fas fa-arrow-left mr-2"></i> Voltar
                </button>
                <button type="button" id="nextBtn" class="ml-auto px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
                    Avan√ßar <i class="fas fa-arrow-right ml-2"></i>
                </button>
                <button type="submit" id="submitBtn" class="hidden ml-auto px-6 py-3 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2">
                    Enviar pesquisa <i class="fas fa-paper-plane ml-2"></i>
                </button>
            </div>
        </form>

        <div id="thankYou" class="thank-you p-8 text-center hidden">
            <div class="mx-auto max-w-xs mb-6">
                <img src="bd17e749-3f02-46e7-9a4c-1e8c35035904.jpeg" alt="√çcone de confirma√ß√£o verde com um selo de aprova√ß√£o e um bal√£o de di√°logo escrito Obrigado!" class="w-full">
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Obrigado pelo seu feedback!</h2>
            <p class="text-gray-600 mb-6">Sua opini√£o √© muito valiosa para n√≥s. Voc√™ contribuiu para melhorarmos nossos servi√ßos.</p>
            <button class="px-6 py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" onclick="location.reload()">
                <i class="fas fa-redo mr-2"></i> Enviar nova pesquisa
            </button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('surveyForm');
        const steps = document.querySelectorAll('.step');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progress');
        const thankYou = document.getElementById('thankYou');
        let currentStep = 0;

        // --- Fun√ß√µes para manipula√ß√£o dos bot√µes de avalia√ß√£o e motivos ---
        // Adaptei esta fun√ß√£o para ser mais gen√©rica e funcionar com m√∫ltiplos grupos de bot√µes
        function setupRatingButtons(selector, hiddenInputId, motivoContainerId) {
            const buttons = document.querySelectorAll(selector);
            const hiddenInput = document.getElementById(hiddenInputId);
            const motivoContainer = document.getElementById(motivoContainerId);

            buttons.forEach(btn => {
                btn.addEventListener('click', function() {
                    buttons.forEach(b => b.classList.remove('active')); // Remove 'active' de todos no grupo
                    this.classList.add('active'); // Adiciona 'active' ao clicado
                    hiddenInput.value = this.dataset.value; // Atualiza o valor do input hidden

                    // Mostra ou esconde o container de motivo baseado na avalia√ß√£o
                    const valor = parseInt(this.dataset.value);
                    if (valor <= 3) {
                        motivoContainer.classList.remove('hidden');
                        motivoContainer.querySelector('textarea').required = true; // Torna o textarea obrigat√≥rio
                    } else {
                        motivoContainer.classList.add('hidden');
                        motivoContainer.querySelector('textarea').required = false; // Torna o textarea n√£o obrigat√≥rio
                        motivoContainer.querySelector('textarea').value = ''; // Limpa o valor
                    }
                });
            });
        }

        // Configura os bot√µes de avalia√ß√£o para cada se√ß√£o espec√≠fica
        setupRatingButtons('.rating-btn-geral', 'rating_geral', 'motivoNegativoContainer');
        setupRatingButtons('.rating-btn-caixa', 'caixa_rating', 'caixaMotivoContainer');
        setupRatingButtons('.rating-btn-entrega', 'entrega_rating', 'entregaMotivoContainer');


        // Exibe o passo atual e atualiza a barra de progresso
        function showStep(step) {
            steps.forEach((s, index) => {
                s.classList.toggle('hidden', index !== step);
            });

            const progress = ((step + 1) / steps.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Atualiza a visibilidade dos bot√µes de navega√ß√£o (Voltar, Avan√ßar, Enviar)
        function updateButtons() {
            prevBtn.classList.toggle('hidden', currentStep === 0);
            nextBtn.classList.toggle('hidden', currentStep === steps.length - 1);
            submitBtn.classList.toggle('hidden', currentStep !== steps.length - 1);
        }

        // --- L√≥gica para os bot√µes de navega√ß√£o ---
        prevBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
                updateButtons();
            }
        });

        nextBtn.addEventListener('click', nextStep); // Chama nextStep para valida√ß√£o antes de avan√ßar

        // Ativar/desativar campo "Especifique..." baseado na sele√ß√£o "Outro"
        const otherRadio = document.querySelector('input[name="contact_reason"][value="outro"]');
        const otherReasonInput = document.querySelector('input[name="other_reason"]');

        if (otherRadio && otherReasonInput) {
            otherRadio.addEventListener('change', function() {
                otherReasonInput.disabled = !this.checked;
                if (this.checked) {
                    otherReasonInput.focus();
                } else {
                    otherReasonInput.value = ''; // Limpa o campo se desmarcado
                }
            });
        }

        // --- L√≥gica de valida√ß√£o e avan√ßo dos passos ---
        function nextStep() {
            let canAdvance = true;

            if (currentStep === 0) { // Step 1: Motivo do Contato
                const selectedReason = document.querySelector('input[name="contact_reason"]:checked');
                if (!selectedReason) {
                    alert('Por favor, selecione o motivo do contato.');
                    canAdvance = false;
                } else if (selectedReason.value === 'outro' && !otherReasonInput.value.trim()) {
                    alert('Por favor, especifique o outro motivo.');
                    canAdvance = false;
                }
            } else if (currentStep === 1) { // Step 2: Avalia√ß√£o Geral
                const ratingGeralInput = document.getElementById('rating_geral');
                if (!ratingGeralInput.value) {
                    alert('Por favor, avalie o nosso atendimento general.');
                    canAdvance = false;
                } else {
                    const motivoContainer = document.getElementById('motivoNegativoContainer');
                    if (!motivoContainer.classList.contains('hidden') && !motivoContainer.querySelector('textarea').value.trim()) {
                        alert('Por favor, informe o motivo da sua avalia√ß√£o.');
                        canAdvance = false;
                    }
                }
            } else if (currentStep === 2) { // Step 3: Avalia√ß√£o do Caixa
                const caixaRatingInput = document.getElementById('caixa_rating');
                if (!caixaRatingInput.value) {
                    alert('Por favor, avalie o atendimento do caixa.');
                    canAdvance = false;
                } else {
                    const motivoContainer = document.getElementById('caixaMotivoContainer');
                    if (!motivoContainer.classList.contains('hidden') && !motivoContainer.querySelector('textarea').value.trim()) {
                        alert('Por favor, informe o motivo da sua avalia√ß√£o do caixa.');
                        canAdvance = false;
                    }
                }
            } else if (currentStep === 3) { // Step 4: Avalia√ß√£o da Entrega
                const entregaRatingInput = document.getElementById('entrega_rating');
                if (!entregaRatingInput.value) {
                    alert('Por favor, avalie o momento da entrega.');
                    canAdvance = false;
                } else {
                    const motivoContainer = document.getElementById('entregaMotivoContainer');
                    if (!motivoContainer.classList.contains('hidden') && !motivoContainer.querySelector('textarea').value.trim()) {
                        alert('Por favor, informe o motivo da sua avalia√ß√£o da entrega.');
                        canAdvance = false;
                    }
                }
            }
            // Steps 5 e 6 (Sugest√£o e Contato) s√£o opcionais, n√£o precisam de valida√ß√£o para avan√ßar

            if (canAdvance) {
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    showStep(currentStep);
                    updateButtons();
                }
            }
        }

        // --- Envio do formul√°rio ---
        form.addEventListener('submit', async function(e) {
            e.preventDefault(); // Evita o comportamento padr√£o de envio do formul√°rio

            // Coletando dados de todos os campos
            const contactReasonRadio = document.querySelector('input[name="contact_reason"]:checked');
            const contactReason = contactReasonRadio ? contactReasonRadio.value : '';
            const otherReason = document.querySelector('input[name="other_reason"]').value;

            const ratingGeral = document.getElementById('rating_geral').value;
            const motivoGeral = document.getElementById('motivoNegativo').value;

            const ratingCaixa = document.getElementById('caixa_rating').value;
            const motivoCaixa = document.getElementById('caixaMotivo').value;

            const ratingEntrega = document.getElementById('entrega_rating').value;
            const motivoEntrega = document.getElementById('entregaMotivo').value;

            const suggestion = document.querySelector('textarea[name="suggestion"]').value;
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;

            // Construindo o objeto de dados para envio
            const dados = {
                nome: name,
                email: email,
                telefone: phone,
                motivo_contato: contactReason === 'outro' ? otherReason : contactReason,
                atendimento: ratingGeral,
                comentario_atendimento: motivoGeral,
                atendimento_caixa: ratingCaixa,
                comentario_caixa: motivoCaixa,
                entrega: ratingEntrega,
                comentario_entrega: motivoEntrega,
                sugestao: suggestion
            };

            // Log para depura√ß√£o (verifique no console do navegador)
            console.log('Dados a serem enviados:', dados);

            try {
                const resposta = await fetch('http://192.168.1.210:3000/api/respostas', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });

                if (!resposta.ok) {
                    const errorText = await resposta.text();
                    throw new Error(`Erro ao enviar dados: ${resposta.status} - ${resposta.statusText}. Detalhes: ${errorText}`);
                }

                alert('Resposta enviada com sucesso!');
                form.classList.add('hidden'); // Esconde o formul√°rio
                thankYou.classList.remove('hidden'); // Mostra a mensagem de agradecimento
                thankYou.classList.add('show'); // Adiciona classe para eventual anima√ß√£o
                window.scrollTo({ top: 0, behavior: 'smooth' }); // Volta para o topo da p√°gina

            } catch (erro) {
                console.error('Erro ao enviar:', erro);
                alert('Erro ao enviar resposta. Por favor, verifique sua conex√£o ou tente novamente mais tarde.');
            }
        });

        // Inicia o formul√°rio no primeiro passo
        showStep(currentStep);
        updateButtons();
    });
    </script>

</body>
</html>